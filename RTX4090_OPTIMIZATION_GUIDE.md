# PROBS RTX 4090 –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø - –ü–û–õ–ù–û–ï –†–£–ö–û–í–û–î–°–¢–í–û

## üìä –ê–ù–ê–õ–ò–ó –û–¢–õ–ò–ß–ò–ô –û–¢ –û–†–ò–ì–ò–ù–ê–õ–¨–ù–û–ì–û PROBS

### üîç –ß—Ç–æ —Ç–∞–∫–æ–µ PROBS?
**PROBS (Predict Result of Beam Search)** - –∞–ª–≥–æ—Ä–∏—Ç–º –æ–±—É—á–µ–Ω–∏—è —Å –ø–æ–¥–∫—Ä–µ–ø–ª–µ–Ω–∏–µ–º –¥–ª—è –Ω–∞—Å—Ç–æ–ª—å–Ω—ã—Ö –∏–≥—Ä, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π beam search –≤–º–µ—Å—Ç–æ MCTS (–∫–∞–∫ –≤ AlphaZero).

**–ö–ª—é—á–µ–≤—ã–µ –æ—Ç–ª–∏—á–∏—è –æ—Ç –Ω–∞—à–µ–π —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

### 1. **Beam Search –≤–º–µ—Å—Ç–æ MCTS**
- **–û—Ä–∏–≥–∏–Ω–∞–ª**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç beam search —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `num_q_s_a_calls` (–≥–ª—É–±–∏–Ω–∞) –∏ `max_depth`
- **–ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**: ‚úÖ –£–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç beam search
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ**: Beam search —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ MCTS –¥–ª—è deterministic –∏–≥—Ä

### 2. **–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –±–µ–∑ —Å–±—Ä–æ—Å–∞ –≤–µ—Å–æ–≤**
- **–û—Ä–∏–≥–∏–Ω–∞–ª**: –ú–æ–¥–µ–ª—å –æ–±—É—á–∞–µ—Ç—Å—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ, –∑–Ω–∞–Ω–∏—è –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è
- **–ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**: ‚úÖ –£–±—Ä–∞–Ω–∞ "carousel" –ª–æ–≥–∏–∫–∞ —Å–±—Ä–æ—Å–∞ –≤–µ—Å–æ–≤
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ**: –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏–π, –Ω–µ—Ç –ø–æ—Ç–µ—Ä–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

### 3. **–ú–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–∫–∞—Ç–∞ –ø—Ä–∏ —É—Ö—É–¥—à–µ–Ω–∏–∏**
- **–û—Ä–∏–≥–∏–Ω–∞–ª**: `update_threshold` - –æ—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –º–æ–¥–µ–ª–∏ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ win rate
- **–ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–∫–∞—Ç–∞
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ**: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–±—ã–≤–∞–Ω–∏—è

### 4. **LR Schedulers –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è**
- **–û—Ä–∏–≥–∏–Ω–∞–ª**: CosineAnnealingLR - –ø–ª–∞–≤–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ learning rate
- **–ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**: ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã LR schedulers
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ**: –õ—É—á—à–∞—è —Å—Ö–æ–¥–∏–º–æ—Å—Ç—å, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ overshooting

### 5. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∏–≥—Ä**
```
–®–∞—Ö–º–∞—Ç—ã 6x6 (–æ—Ä–∏–≥–∏–Ω–∞–ª):    –¢–æ–≥—ã–∑–∫—É–º–∞–ª–∞–∫ (–Ω–∞—à–∞ –∏–≥—Ä–∞):
- v_train_episodes: 6000    ‚Üí 8000 (–º–∞—Å—à—Ç–∞–± –ø–æ–¥ GPU)
- q_train_episodes: 3000    ‚Üí 4000 (–º–∞—Å—à—Ç–∞–± –ø–æ–¥ GPU)
- num_q_s_a_calls: 50       ‚Üí 60 (–≥–ª—É–±–∂–µ beam search)
- batch_size: 256           ‚Üí 1024 (48GB VRAM)
```

---

## üöÄ RTX 4090 –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

### üéØ –ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
- **GPU**: RTX 4090 (48GB GDDR6X VRAM)
- **CPU**: 64 —è–¥—Ä–∞ (AMD Ryzen Threadripper –∏–ª–∏ –∞–Ω–∞–ª–æ–≥)
- **RAM**: –ú–∏–Ω–∏–º—É–º 128GB –¥–ª—è –±—É—Ñ–µ—Ä–æ–≤

### ‚ö° –ö–ª—é—á–µ–≤—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### 1. **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ GPU**
```yaml
train_batch_size: 1024          # –í–º–µ—Å—Ç–æ 256 - –º–∞–∫—Å–∏–º—É–º –¥–ª—è 48GB
self_learning_batch_size: 2048  # –û–≥—Ä–æ–º–Ω—ã–µ –±–∞—Ç—á–∏ –¥–ª—è self-play –¥–∞–Ω–Ω—ã—Ö
get_q_dataset_batch_size: 512   # –û–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è Q-–æ–±—É—á–µ–Ω–∏—è
```
**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ**: –ü–æ–ª–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ 48GB VRAM, –º–µ–Ω—å—à–µ overhead –Ω–∞ kernel launches

#### 2. **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º CPU**
```yaml
sub_processes_cnt: 32           # –í–º–µ—Å—Ç–æ 4 - –¥–ª—è 64 —è–¥–µ—Ä CPU
threads_cnt: 32                 # –î–ª—è –±–∞—Ç—Ç–ª–æ–≤ –∏ –æ—Ü–µ–Ω–∫–∏
```
**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —è–¥–µ—Ä, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

#### 3. **–ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è I/O –æ–ø–µ—Ä–∞—Ü–∏–π**
```yaml
mem_max_episodes: 250000        # –í–º–µ—Å—Ç–æ 50000 - –æ–≥—Ä–æ–º–Ω—ã–π –±—É—Ñ–µ—Ä
```
**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ**: –î–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –≤ RAM, –Ω–µ—Ç bottleneck –Ω–∞ –¥–∏—Å–∫

#### 4. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è**
```yaml
v_train_episodes: 8000          # –ú–∞—Å—à—Ç–∞–± –ø–æ–¥ GPU —Å–∫–æ—Ä–æ—Å—Ç—å
q_train_episodes: 4000          # –õ—É—á—à–µ–µ Q-–æ–±—É—á–µ–Ω–∏–µ
num_q_s_a_calls: 60             # –ì–ª—É–±–∂–µ beam search
max_depth: 80                   # –ì–ª—É–±–∂–µ –¥–µ—Ä–µ–≤–æ –ø–æ–∏—Å–∫–∞
alphazero_move_num_sampling_moves: 12  # –õ—É—á—à–µ exploration
```

#### 5. **CUDA –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**
```python
torch.backends.cudnn.benchmark = True    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ª—É—á—à–∏—Ö —è–¥–µ—Ä
torch.set_float32_matmul_precision('high')  # TF32 –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
```

#### 6. **–ë–µ–∑ –±—É—Å—Ç–∏–Ω–≥–∞ + –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ (–∫–∞–∫ –∑–∞–ø—Ä–æ—à–µ–Ω–æ)**
- ‚ùå –£–±—Ä–∞–Ω–∞ supervised boosting —Ñ–∞–∑–∞
- ‚ùå –£–±—Ä–∞–Ω –º–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–∫–∞—Ç–∞ (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º PROBS!)
- ‚úÖ –ß–∏—Å—Ç–æ–µ RL –æ–±—É—á–µ–Ω–∏–µ —Å –Ω—É–ª—è –±–µ–∑ –æ—Ç–∫–∞—Ç–æ–≤
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ**: –ú–æ–¥–µ–ª—å –æ–±—É—á–∞–µ—Ç—Å—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ, –∫–∞–∫ —É –∞–≤—Ç–æ—Ä–∞, –¥–æ—Å—Ç–∏–≥–∞—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ win rate

---

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **Self-play**: ~10-20x –±—ã—Å—Ç—Ä–µ–µ —á–µ–º –Ω–∞ CPU
- **–û–±—É—á–µ–Ω–∏–µ**: ~50-100x –±—ã—Å—Ç—Ä–µ–µ –±–ª–∞–≥–æ–¥–∞—Ä—è –±–æ–ª—å—à–∏–º –±–∞—Ç—á–∞–º
- **Beam search**: –ì–ª—É–±–∂–µ –æ—Ü–µ–Ω–∫–∞ –ø–æ–∑–∏—Ü–∏–π

### –ö–∞—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–∏
- –õ—É—á—à–∞—è —Å—Ö–æ–¥–∏–º–æ—Å—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä—è LR schedulers
- –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –±–ª–∞–≥–æ–¥–∞—Ä—è –º–µ—Ö–∞–Ω–∏–∑–º—É –æ—Ç–∫–∞—Ç–∞
- –ë–æ–ª–µ–µ –≥–ª—É–±–æ–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∏–≥—Ä—ã –±–ª–∞–≥–æ–¥–∞—Ä—è beam search

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–æ–±—Ä–∞–Ω—ã –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è (500+ –∏—Ç–µ—Ä–∞—Ü–∏–π)
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è –Ω–µ–¥–µ–ª—è–º–∏ –±–µ–∑ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞

---

## üõ†Ô∏è –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï

### –ó–∞–ø—É—Å–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
```bash
python run_probs_rtx4090.py
```

### –¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞
```bash
python run_probs_rtx4090.py --config-only
```

### –ë–µ–Ω—á–º–∞—Ä–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```bash
python run_probs_rtx4090.py --benchmark
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—É—á–µ–Ω–∏—è
```bash
# TensorBoard
tensorboard --logdir checkpoints/togyzkumalak_rtx4090/

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f probs_training.log
```

---

## üîß –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

### –î–ª—è –µ—â–µ –±–æ–ª—å—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
1. **Mixed Precision Training**: FP16 –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ (—Ç—Ä–µ–±—É–µ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–æ–¥–∞)
2. **Gradient Checkpointing**: –î–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ VRAM –ø—Ä–∏ –æ—á–µ–Ω—å –≥–ª—É–±–æ–∫–∏—Ö —Å–µ—Ç—è—Ö
3. **Data Parallelism**: –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ RTX 4090
4. **NUMA Optimization**: –ü—Ä–∏–≤—è–∑–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∫ CPU —Å–æ–∫–µ—Ç–∞–º

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ GPU:
```bash
# NVIDIA-SMI –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
watch -n 1 nvidia-smi

# GPU utilization
nvidia-smi --query-gpu=utilization.gpu,utilization.memory --format=csv
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ:
- **GPU**: RTX 4090 —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –¥—Ä–∞–π–≤–µ—Ä–∞–º–∏
- **CUDA**: 12.1+ —Å cuDNN 8.9+
- **RAM**: –ú–∏–Ω–∏–º—É–º 128GB
- **Disk**: NVMe SSD –¥–ª—è —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **Out of Memory**: –£–º–µ–Ω—å—à–∏—Ç—å `train_batch_size` –¥–æ 512
2. **CPU bottleneck**: –£–º–µ–Ω—å—à–∏—Ç—å `sub_processes_cnt` –¥–æ 16-24
3. **Disk I/O**: –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä—ã–µ –¥–∏—Å–∫–∏ –∏–ª–∏ —É–º–µ–Ω—å—à–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π

### –†–µ–∑–µ—Ä–≤–Ω—ã–µ –ø–ª–∞–Ω—ã:
- –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å 32 –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ ‚Üí —É–º–µ–Ω—å—à–∏—Ç—å –¥–æ 16
- –ü—Ä–∏ OOM –Ω–∞ GPU ‚Üí —É–º–µ–Ω—å—à–∏—Ç—å –±–∞—Ç—á–∏ –¥–æ 512/1024
- –ü—Ä–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–º –æ–±—É—á–µ–Ω–∏–∏ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å PCIe bandwidth

---

## üéØ –°–†–ê–í–ù–ï–ù–ò–ï –° –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ú –ü–†–û–ï–ö–¢–û–ú

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û—Ä–∏–≥–∏–Ω–∞–ª (Chess 6x6) | –ù–∞—à–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è | –ü—Ä–∏—á–∏–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è |
|----------|---------------------|------------------|-------------------|
| `sub_processes_cnt` | 10 | 32 | 64 —è–¥—Ä–∞ CPU |
| `train_batch_size` | 256 | 1024 | 48GB VRAM |
| `v_train_episodes` | 6000 | 8000 | GPU –±—ã—Å—Ç—Ä–µ–µ |
| `q_train_episodes` | 3000 | 4000 | –õ—É—á—à–µ Q-–æ–±—É—á–µ–Ω–∏–µ |
| `num_q_s_a_calls` | 50 | 60 | –ì–ª—É–±–∂–µ beam search |
| `mem_max_episodes` | 100000 | 250000 | –ë–æ–ª—å—à–µ RAM |
| `update_threshold` | - | 0.52 | –ú–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–∫–∞—Ç–∞ |

**–ò—Ç–æ–≥–æ**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–∞–µ—Ç ~20-50x –ø—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –ª—É—á—à–µ–º –∫–∞—á–µ—Å—Ç–≤–µ –æ–±—É—á–µ–Ω–∏—è –±–ª–∞–≥–æ–¥–∞—Ä—è –º–µ—Ö–∞–Ω–∏–∑–º–∞–º —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ PROBS.